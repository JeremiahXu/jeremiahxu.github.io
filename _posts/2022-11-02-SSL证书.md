---
layout: post
read_time: true
show_date: true
title: SSLè¯ä¹¦Â https
date: 2022-11-02 14:00:09 +0800
description: ğŸ”†è®©ä½ çš„httpåŠ ä¸€ä¸ªs
img: posts/2022-11-02-SSLè¯ä¹¦/2022-11-02-14-59-56-package_banner_ssl.jpg
tags: [ssl]
author: Jeremiah
github: jeremiahxu/jeremiahxu.github.io/blob/main/_posts/2022-11-02-SSLè¯ä¹¦.md 
---

ğŸ”†è®©ä½ çš„httpåŠ ä¸€ä¸ªs

SSLè¯ä¹¦æ˜¯[æ•°å­—è¯ä¹¦](https://baike.baidu.com/item/%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6/326874?fromModule=lemma_inlink)çš„ä¸€ç§ï¼Œç±»ä¼¼äºé©¾é©¶è¯ã€æŠ¤ç…§å’Œè¥ä¸šæ‰§ç…§çš„ç”µå­å‰¯æœ¬ã€‚å› ä¸ºé…ç½®åœ¨æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿç§°ä¸ºSSLæœåŠ¡å™¨è¯ä¹¦ã€‚

SSL è¯ä¹¦Â [1]Â Â å°±æ˜¯éµå®ˆÂ [SSLåè®®](https://baike.baidu.com/item/SSL%E5%8D%8F%E8%AE%AE/4602579?fromModule=lemma_inlink)ï¼Œç”±å—ä¿¡ä»»çš„æ•°å­—è¯ä¹¦é¢å‘æœºæ„CAï¼Œåœ¨éªŒè¯æœåŠ¡å™¨èº«ä»½åé¢å‘ï¼Œå…·æœ‰æœåŠ¡å™¨èº«ä»½éªŒè¯å’Œæ•°æ®ä¼ è¾“åŠ å¯†åŠŸèƒ½ã€‚

SSL/TLS åè®®çš„åŸºæœ¬æ€è·¯æ˜¯é‡‡ç”¨å…¬é’¥åŠ å¯†æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å…ˆå‘æœåŠ¡å™¨ç«¯ç´¢è¦å…¬é’¥ï¼Œç„¶åç”¨å…¬é’¥åŠ å¯†ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯†æ–‡åï¼Œç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ã€‚

## Screenshot

![](../assets/img/posts/2022-11-02-SSLè¯ä¹¦/2023-03-16-10-21-07-image.png)

## SSLè¯ä¹¦æ ¼å¼

- PEMæ ¼å¼ï¼šä¸»è¦è¯ä¹¦æ–‡ä»¶ã€‚
  
  PEMæ ¼å¼çš„è¯ä¹¦æ–‡ä»¶æ˜¯é‡‡ç”¨Base64ç¼–ç çš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦å°†è¯ä¹¦æ–‡ä»¶ä¿®æ”¹æˆå…¶ä»–æ ¼å¼ã€‚å…³äºè¯ä¹¦æ ¼å¼è½¬æ¢çš„å…·ä½“æ“ä½œï¼Œè¯·å‚è§[å¦‚ä½•è½¬æ¢è¯ä¹¦æ ¼å¼ï¼Ÿ](https://help.aliyun.com/document_detail/364239.html#concept-2154188 "ä¸åŒWebæœåŠ¡å™¨æ”¯æŒçš„è¯ä¹¦æ ¼å¼ä¸åŒã€‚æ‚¨éœ€è¦å°†å·²ç­¾å‘çš„è¯ä¹¦è½¬æ¢ä¸ºé€‚ç”¨å½“å‰WebæœåŠ¡å™¨çš„æ ¼å¼ï¼Œæ‰èƒ½æ­£å¸¸å®‰è£…SSLè¯ä¹¦ã€‚æœ¬æ–‡ä»‹ç»å¦‚ä½•è½¬æ¢è¯ä¹¦æ ¼å¼ã€‚")ã€‚
  
  + `privkey.pem`  : è¯ä¹¦çš„ç§é’¥.
  + `fullchain.pem`: å¤§å¤šæ•°æœåŠ¡å™¨è½¯ä»¶ä¸­ä½¿ç”¨çš„è¯ä¹¦æ–‡ä»¶
  + `chain.pem`    : used for OCSP stapling in Nginx >=1.3.7.
  + `cert.pem`     : will break many server configurations, and should not be used without reading further documentation (see link at [`https://certbot.eff.org/docs/using.html#where-are-my-certificates`](https://certbot.eff.org/docs/using.html#where-are-my-certificates " ")). 

- Keyæ ¼å¼ï¼šè¯ä¹¦ç§é’¥æ–‡ä»¶ã€‚
  `privkey.pem`æ–‡ä»¶ ç›´æ¥ä¿®æ”¹ä¸º `domain.key`

- Crtæ ¼å¼ï¼šè¯ä¹¦å…¬é’¥æ–‡ä»¶ã€‚
  
  1. Crtæ ¼å¼ï¼šå•ä¸ªæ–‡ä»¶ã€‚
      domain.com_fullchain.crt å®Œæ•´çš„é“¾æ–‡ä»¶
     
      `fullchain.pem`æ–‡ä»¶ ç›´æ¥ä¿®æ”¹ä¸º `domain_fullchain.crt`
  
  2. Crtæ ¼å¼ï¼šå¤šä¸ªæ–‡ä»¶ç»„åˆã€‚
      domain.com_public.crt åŸŸåå…¬é’¥æ–‡ä»¶
      domain.com_chain.crt é“¾æ–‡ä»¶
     
     ![](../assets/img/posts/2022-11-02-SSLè¯ä¹¦/2023-03-16-10-10-03-image.png)
     
      PEMæ ¼å¼è¯ä¹¦ = åŸŸåè¯ä¹¦.crt+ æ ¹è¯ä¹¦(root_bundle).crt

- å°†JKSæ ¼å¼è¯ä¹¦è½¬æ¢æˆPFXæ ¼å¼ã€‚

- å°†PEMã€KEYæˆ–CRTæ ¼å¼è¯ä¹¦è½¬æ¢ä¸ºPFXæ ¼å¼ã€‚

- CSRæ ¼å¼ï¼šæœºæ„æœªéªŒè¯å‰çš„ä¸­é—´æ–‡ä»¶ï¼ŒåŒ…å«åŸŸåç­‰ä¿¡æ¯ã€‚

## ç­¾å‘æœºæ„

### 1. å¼€æºæœºæ„ï¼šLet's Encrypt, openSSL

**å®˜ç½‘(letsencrypt)çš„ç­¾å‘æ–¹æ³•**<[éƒ¨ç½²å…è´¹sslè¯ä¹¦(letsencrypt)çš„æ–¹æ³•](https://letsencrypt.org/zh-cn/)>

ä¸ºäº†åœ¨æ‚¨çš„ç½‘ç«™ä¸Šå¯ç”¨ HTTPSï¼Œæ‚¨éœ€è¦ä»è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰è·å–è¯ä¹¦ï¼ˆä¸€ç§æ–‡ä»¶ï¼‰ã€‚ 

Letâ€™s Encrypt æ­£æ˜¯å…¶ä¸­ä¸€å®¶è¯ä¹¦é¢å‘æœºæ„ã€‚  
Letâ€™s Encrypt æ¨èæœ€ä½³å®‰è£…æ–¹å¼[certbot](https://certbot.eff.org/)ã€‚ 

certbotç­¾å‘æ³›åŸŸåè¯ä¹¦*.jerem.com,æˆ–è€…æ··åˆåŸŸåè¯ä¹¦ jerem.com & *.jerem.com
```bash
sudo certbot certonly --manual \
                      --preferred-challenges dns \
                      --server https://acme-v02.api.letsencrypt.org/directory
```
+ certonly ä»…è·å–è¯ä¹¦   
+ --manual æ‰‹åŠ¨æ–¹å¼   
+ --preferred-challenges dns è¦DNSæ–¹å¼éªŒè¯ï¼ŒæŒ‰æç¤ºæ·»åŠ acme_TXTè®°å½•åˆ°è§£æä¸Šã€‚  
+ --server https://acme-v02.api.letsencrypt.org/directory éœ€è¦acme-v02æ–¹å¼ï¼Œacme-v01æ–¹å¼ä»…æ”¯æŒæ™®é€šåŸŸå   

#### windowsä¸‹éƒ¨ç½²å…è´¹sslè¯ä¹¦(letsencrypt)çš„æ–¹æ³•

å‚è€ƒ <[windowsä¸‹éƒ¨ç½²å…è´¹sslè¯ä¹¦(letsencrypt)çš„æ–¹æ³•](http://www.idcbaby.com/43100/)>

### 2. é˜¿é‡Œäº‘ï¼šæœ‰å…è´¹ç‰ˆDVç‰ˆsslè¯ä¹¦

#### åŸŸåå‹ï¼ˆDVï¼‰SSL è¯ä¹¦æäº¤æµç¨‹

å‚è€ƒ <[åŸŸåå‹ï¼ˆDVï¼‰SSL è¯ä¹¦æäº¤æµç¨‹-è´­ä¹°æŒ‡å¯¼-è…¾è®¯äº‘](https://cloud.tencent.com/document/buy-guide/400/47285)>

#### SSLè¯ä¹¦ç”³è¯·

![](../assets/img/posts/2022-11-02-SSLè¯ä¹¦/2022-11-02-14-11-16-image.png)

## è¯ä¹¦éƒ¨ç½²--åœ¨NginxæœåŠ¡å™¨ä¸Šå®‰è£…è¯ä¹¦

### æ­¥éª¤ä¸€ï¼šä¸‹è½½è¯ä¹¦åˆ°æœ¬åœ°

ä¸‹è½½ä»¥ä¸‹æ–‡ä»¶ï¼š

![](../assets/img/posts/2022-11-02-SSLè¯ä¹¦/2022-11-02-14-18-01-image.png)

### æ­¥éª¤äºŒï¼šåœ¨NginxæœåŠ¡å™¨ä¸Šå®‰è£…è¯ä¹¦--dockeræ–¹å¼

1. ä¸‹è½½nginxé•œåƒ
   
   ```bash
   docker pull nginx
   ```

2. æ–°å»ºnginxé…ç½®æ–‡ä»¶å¤¹
   
   ```bash
   mkdir nginx/conf.d
   ```

3. æ–°å»ºæ–‡ä»¶nginx.conf
   
   ```bash
   #ä»¥ä¸‹å±æ€§ä¸­ï¼Œä»¥sslå¼€å¤´çš„å±æ€§è¡¨ç¤ºä¸è¯ä¹¦é…ç½®æœ‰å…³ã€‚
   server {
       listen 443 ssl;
       #é…ç½®HTTPSçš„é»˜è®¤è®¿é—®ç«¯å£ä¸º443ã€‚
       #å¦‚æœæœªåœ¨æ­¤å¤„é…ç½®HTTPSçš„é»˜è®¤è®¿é—®ç«¯å£ï¼Œå¯èƒ½ä¼šé€ æˆNginxæ— æ³•å¯åŠ¨ã€‚
       #å¦‚æœæ‚¨ä½¿ç”¨Nginx 1.15.0åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨listen 443 sslä»£æ›¿listen 443å’Œssl onã€‚
       server_name jeremiah.ltd;
       root html;
       index index.html index.htm;
       ssl_certificate conf.d/cert/8703236_jeremiah.ltd.pem;  
       ssl_certificate_key conf.d/cert/8703236_jeremiah.ltd.key; 
       ssl_session_timeout 5m;
       ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
       #è¡¨ç¤ºä½¿ç”¨çš„åŠ å¯†å¥—ä»¶çš„ç±»å‹ã€‚
       ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3; #è¡¨ç¤ºä½¿ç”¨çš„TLSåè®®çš„ç±»å‹ï¼Œæ‚¨éœ€è¦è‡ªè¡Œè¯„ä¼°æ˜¯å¦é…ç½®TLSv1.1åè®®ã€‚
       ssl_prefer_server_ciphers on;
       location / {
           root /usr/share/nginx/html;  #Webç½‘ç«™ç¨‹åºå­˜æ”¾ç›®å½•ã€‚
           index index.html index.htm;
       }
   }
   
   server {
       listen 80;
       server_name jeremiah.ltd; #éœ€è¦å°†yourdomainæ›¿æ¢æˆè¯ä¹¦ç»‘å®šçš„åŸŸåã€‚
       rewrite ^(.*)$ https://$host$1; #å°†æ‰€æœ‰HTTPè¯·æ±‚é€šè¿‡rewriteæŒ‡ä»¤é‡å®šå‘åˆ°HTTPSã€‚
       location / {
           index index.html index.htm;
       }
   }
   ```

4. æ–°å»ºsslè¯ä¹¦æ–‡ä»¶å¤¹
   
   ```bash
   mkdir nginx/conf.d/cert
   ```

5. å¤åˆ¶SSLè¯ä¹¦æ–‡ä»¶åˆ°certæ–‡ä»¶å¤¹ä¸‹ã€‚

6. è¿è¡Œå®¹å™¨
   
   ```bash
   docker run --name jere-nginx-221028 -p 80:80 -p 443:443 -v /home/ubuntu/jeremiahxu.github.io/_site:/usr/share/nginx/html -v /home/ubuntu/nginx/conf.d:/etc/nginx/conf.d:ro  -itd nginx
   ```