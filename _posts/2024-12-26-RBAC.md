---
layout: post
read_time: true
show_date: true
title:  “用户-角色-权限” 的三层模型（RBAC 模型）
date: 2024-12-26 12:00:00 +0800
description: 角色，作为中间层，本质上是“权限的集合”。
img: posts/2024-12-26-RBAC/RBAC.png
tags: [后端]
author: Jeremiah
github: 
---

角色，作为中间层，本质上是“权限的集合”。
## 一、核心内容梳理

- **权限与角色关系**：角色是权限的集合，用户通过关联角色获得权限（并集），实现批量分配和管理。
- **权限类型与层级**：权限分为菜单、页面、按钮、数据等类型，存在层级包含关系（如菜单包含页面，页面包含按钮）。
- **权限获取方式**：用户通过角色获得权限，采用“用户→角色→权限（并集）”的间接关联方式。
- **权限存储场景**：多系统/微服务架构下，用户信息由SSO统一管理，权限及用户-权限关联在各子系统或权限中心管理。
- **页面权限本质**：页面权限是具体权限项，角色是权限的组织载体，页面和菜单是权限的作用对象，二者定位不同。

## 二、主流方案及优缺点分析

### 1. 角色-权限模型（主流推荐）
用户关联角色，角色关联权限，权限分散在各子系统管理，用户权限通过“用户→角色→权限并集”计算。
优点：灵活性高，易于维护，符合最小权限原则。
缺点：权限计算需多步关联，性能略低于直接存储用户权限（可通过缓存优化）。

### 2. 权限存储的“混合模式”（主流实践）
用户信息由SSO统一管理，子系统专属权限存储在子系统，跨系统通用权限存储在统一权限中心。
优点：兼顾统一性和灵活性，适合微服务架构。

## 三、主流推荐方案总结

- 推荐方案：角色-权限模型 + 混合存储模式。
- 权限通过角色批量管理，用户关联角色获取权限（并集），避免直接关联权限。用户身份信息由SSO统一存储，子系统专属权限及用户-角色关联存储在子系统，跨系统通用权限统一存储在权限中心。
- 优势：平衡灵活性、维护性和性能，适配绝大多数企业级系统。

## 四、简单场景与复杂场景对比

- 用户直接分配权限适合极简单系统，操作高效。
- 角色-权限模型在用户量、权限量较大时能大幅减少重复操作，提升管理效率。
- 角色与业务身份强相关，权限变更只需调整角色，便于系统迭代和权限追溯。

## 五、RBAC模型的细化与实际开发落地

- 权限是否需要单独定义，取决于功能界限是否明确，如“查看个人数据”与“查看所有数据”需拆分。
- 按钮权限（操作开关）、数据权限（范围控制）、菜单权限（入口控制）是常见类型。
- 最终权限为所有角色权限的叠加（去重），满足多角色、多职能用户需求。

## 六、权限系统设计中的层级化集合问题

- 菜单、页面、按钮都是权限集合，但不等同于角色。
- 功能权限管理UI层级的权限集合，角色对应业务身份，是对功能权限集合的再打包。
- 功能权限有层级继承（菜单→页面→按钮），角色则横向打包业务权限。

## 七、权限存储位置与关联关系设计

- 权限应与其控制的资源绑定，资源属于具体业务子系统。
- 微服务/多子系统架构下，用户信息由SSO统一管理，用户-权限关联建议存储在子系统本地或权限中心。单体系统可集中存储所有权限及关联关系。
- 每个子系统维护自身权限表，跨系统角色建议引入权限中心统一管理。

## 八、用户-角色与角色-权限关联表的存储位置

- 用户-角色关联表通常放在统一身份认证/用户中心服务（如SSO），便于统一管理。
- 角色-权限关联表通常放在各业务子系统或独立的权限中心服务，便于灵活管理。
- 小型系统可集中存储，简化架构；大型分布式系统需分散存储，兼顾灵活性和一致性。

## 九、角色表的存储位置与作用范围

- 跨系统通用角色存储在统一用户中心或权限中心，供全系统共享。
- 子系统私有角色存储在对应业务子系统，便于业务团队自主维护。
- 单体应用可集中存储，微服务架构下通用角色统一管理，私有角色分散管理。

## 十、微服务架构下角色获取与管理逻辑

- 用户的完整角色集=通用角色（跨系统）+子系统私有角色（业务专属），分步获取。
- 通过角色的“范围字段”区分通用与私有角色，权限校验时聚合两者权限。
- 统一用户中心提供标准化接口返回通用角色，子系统内部接口查询私有角色。
- 解耦、灵活、安全，既保证全局角色一致性，又保留子系统灵活性。

## 十一、结论/最佳实践总结

- 主流方案优势：批量管理、灵活扩展、易于维护，适合复杂系统。
- 适用场景与推荐实践：极简单场景可直接关联权限，中大型系统优先采用角色中间层。

“用户→角色→权限”是一种“间接关联”，通过角色中间层实现权限批量管理和业务身份映射，提升系统迭代效率。角色是权限的集合，用户可拥有多个角色，其权限为所有角色权限的并集。这种三层模型（RBAC）既灵活又高效，能显著降低管理成本。


## 实际开发中“RBAC模型”的细化落地：

是对“权限存在的必要性”（有明确功能界限）的判断，以及不同权限类型的具体表现，完全贴合实际开发中的设计思路：

### 1. 权限的核心判断标准：功能界限明确
你提到“权限的存在取决于有无该功能有明显界限”，这是关键。比如“查看个人数据”和“查看所有数据”，两者能清晰区分操作范围，所以有必要拆分为两个权限；如果两个操作的界限模糊（比如“查看数据A”和“查看数据A简化版”），硬拆反而会增加系统复杂度，这种情况就可能不需要单独定义权限。

### 2. 常见权限类型的具体表现
- **按钮权限**：核心是“操作开关”，比如“删除按钮”显示与否，直接对应“是否允许删除操作”，通常和单一功能强绑定。
- **数据权限**：核心是“范围控制”，比如同是“查看订单”，普通销售只能看自己的订单，经理能看全部门的，这种“数据范围差异”就需要通过不同权限区分。
- **菜单权限**：核心是“入口控制”，决定用户能否看到某个菜单（进而进入对应页面），是最基础的权限层级，通常和页面级别的访问权限挂钩。

### 3. 权限组合的逻辑
你说的数据权限“并集”（比如同时有个人和所有人权限，就能看全部）、按钮/菜单的“有无”判断，其实都是权限系统的核心运算逻辑——**最终权限=所有角色权限的叠加（去重）**。这种设计既能满足“一个用户身兼多职”的场景（比如既是编辑又是审核员），又能保证权限管理的清晰性。



## 权限系统设计中“层级化集合”的核心问题：
菜单、页面、按钮这些UI层级的权限，本质上和角色一样都是“权限的集合”，但主流设计中通常不会把它们等同于“角色”，而是通过“权限维度拆分”来处理，核心原因是**职责边界不同**。

